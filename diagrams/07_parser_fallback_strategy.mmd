flowchart TD
    Start["PDF File Upload"] --> CheckParser{"Preferred Parser?"}
    
    CheckParser -->|Auto| PyMuPDF["Try PyMuPDF Parser"]
    CheckParser -->|PyMuPDF| PyMuPDF
    CheckParser -->|Docling| Docling["Try Docling Parser"]
    CheckParser -->|Textract| Textract["Try Textract Parser"]
    
    PyMuPDF --> CheckResult1{"Extraction >= 50%<br/>AND<br/>Confidence >= 0.7?"}
    CheckResult1 -->|Yes| Success1["✅ Return PyMuPDF Result"]
    CheckResult1 -->|No| StoreResult["Store as Candidate"]
    
    StoreResult --> CheckExtraction{"Extraction < 50%<br/>OR<br/>Confidence < 0.7?"}
    CheckExtraction -->|Yes| TryDocling["Try Docling Parser<br/>for structured content"]
    CheckExtraction -->|No| ReturnBest["Return Best Available Result"]
    
    TryDocling --> CheckDocling{"Docling<br/>Success?"}
    CheckDocling -->|Yes| CompareDocling{"Docling Better<br/>than PyMuPDF?"}
    CheckDocling -->|Timeout/Error| CheckTextract{"Extraction < 30%?"}
    
    CompareDocling -->|Yes| Success3["✅ Return Docling Result"]
    CompareDocling -->|No| CheckTextract
    
    CheckTextract -->|Yes| CheckAWS{"AWS Credentials<br/>Available?"}
    CheckTextract -->|No| ReturnBest
    
    CheckAWS -->|Yes| Textract
    CheckAWS -->|No| FallbackPyMuPDF["Fallback to PyMuPDF Result"]
    
    Textract --> CheckTextractResult{"Textract<br/>Success?"}
    CheckTextractResult -->|Yes| CompareTextract{"Textract Confidence<br/>> Best Result?"}
    CheckTextractResult -->|Timeout/Error| FallbackPyMuPDF
    
    CompareTextract -->|Yes| Success2["✅ Return Textract Result"]
    CompareTextract -->|No| ReturnBest
    
    Docling -->|Direct Selection| CheckDocling
    Textract -->|Direct Selection| CheckTextractResult
    
    Success1 --> End["ParsedDocument"]
    Success2 --> End
    Success3 --> End
    ReturnBest --> End
    FallbackPyMuPDF --> End
    
    style Success1 fill:#c8e6c9
    style Success2 fill:#c8e6c9
    style Success3 fill:#c8e6c9
    style FallbackPyMuPDF fill:#fff9c4
    style ReturnBest fill:#fff9c4
    style Docling fill:#e3f2fd



