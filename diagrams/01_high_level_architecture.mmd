graph TB
    subgraph UI["User Interface Layer"]
        UI_App["Streamlit Web UI<br/>app.py"]
        Sidebar["Sidebar<br/>Model Selection<br/>Parser Settings"]
        MainArea["Main Area<br/>File Upload<br/>Query Interface<br/>Metrics Dashboard"]
    end
    
    subgraph App["Application Layer"]
        DocProcessor["DocumentProcessor<br/>ingestion/document_processor.py<br/>Orchestrates processing<br/>Progress tracking<br/>Error handling"]
        RAGSystem["RAGSystem<br/>rag_system.py<br/>Vector store management<br/>Query processing<br/>LLM integration"]
    end
    
    subgraph Parser["Parser Layer"]
        ParserFactory["ParserFactory<br/>parsers/parser_factory.py<br/>Parser selection<br/>Fallback strategy"]
        PyMuPDF["PyMuPDF Parser<br/>Fast text extraction"]
        Docling["Docling Parser<br/>Structured documents<br/>Tables & layouts"]
        Textract["Textract Parser<br/>AWS OCR for scanned PDFs"]
    end
    
    subgraph Process["Processing Layer"]
        Tokenizer["TokenTextSplitter<br/>utils/tokenizer.py<br/>Token-aware chunking<br/>Token counting<br/>Sentence preservation"]
        Embeddings["OpenAI Embeddings<br/>text-embedding-3-small<br/>text-embedding-3-large<br/>text-embedding-ada-002"]
        VectorStore["FAISS Vector Store<br/>Similarity search<br/>MMR retrieval<br/>Incremental updates"]
    end
    
    subgraph LLM["LLM Layer"]
        LLMProvider{"LLM Provider"}
        OpenAI["OpenAI API<br/>GPT-3.5-turbo<br/>GPT-4<br/>GPT-4o"]
        Cerebras["Cerebras API<br/>Llama3.1-8b<br/>Llama-3.3-70b<br/>Qwen-3-32b"]
    end
    
    subgraph Analytics["Analytics & Metrics"]
        MetricsCollector["MetricsCollector<br/>metrics/metrics_collector.py<br/>Processing metrics<br/>Query metrics<br/>Token tracking"]
        TokenAnalysis["Token Analysis<br/>Distribution charts<br/>Chunk statistics<br/>Usage patterns"]
    end
    
    UI_App --> Sidebar
    UI_App --> MainArea
    MainArea --> DocProcessor
    MainArea --> RAGSystem
    
    DocProcessor --> ParserFactory
    ParserFactory --> PyMuPDF
    ParserFactory --> Docling
    ParserFactory --> Textract
    
    DocProcessor --> RAGSystem
    RAGSystem --> Tokenizer
    RAGSystem --> Embeddings
    RAGSystem --> VectorStore
    RAGSystem --> LLMProvider
    
    LLMProvider --> OpenAI
    LLMProvider --> Cerebras
    
    DocProcessor --> MetricsCollector
    RAGSystem --> MetricsCollector
    Tokenizer --> MetricsCollector
    MetricsCollector --> TokenAnalysis
    
    style UI_App fill:#e1f5ff
    style RAGSystem fill:#fff4e1
    style VectorStore fill:#e8f5e9
    style MetricsCollector fill:#f3e5f5
    style Tokenizer fill:#fff9c4
    style TokenAnalysis fill:#f3e5f5

