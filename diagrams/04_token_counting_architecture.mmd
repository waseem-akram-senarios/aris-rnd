graph LR
    subgraph Sources["Token Counting Sources"]
        DocText["Document Text"]
        QueryText["Query Text"]
        ContextText["Context Chunks"]
        ResponseText["LLM Response"]
    end
    
    subgraph Counter["Token Counter Component"]
        Tokenizer["TokenTextSplitter<br/>utils/tokenizer.py"]
        TikToken["TikToken Encoding<br/>Model-specific"]
    end
    
    subgraph UseCases["Token Counting Use Cases"]
        Chunking["Chunking<br/>Split by tokens"]
        UIWidget["UI Token Counter<br/>Real-time counting"]
        QueryTracking["Query Token Tracking<br/>Context + Response"]
        MetricsAnalysis["Token Analysis<br/>Distribution & Stats"]
    end
    
    subgraph Storage["Token Storage & Display"]
        ChunkMetadata["Chunk Metadata<br/>token_count field"]
        MetricsDB["Metrics Collector<br/>Token statistics"]
        UIDisplay["UI Display<br/>Token counts<br/>Charts<br/>Statistics"]
    end
    
    DocText --> Tokenizer
    QueryText --> Tokenizer
    ContextText --> Tokenizer
    ResponseText --> Tokenizer
    
    Tokenizer --> TikToken
    TikToken --> Chunking
    TikToken --> UIWidget
    TikToken --> QueryTracking
    TikToken --> MetricsAnalysis
    
    Chunking --> ChunkMetadata
    QueryTracking --> MetricsDB
    MetricsAnalysis --> MetricsDB
    MetricsDB --> UIDisplay
    ChunkMetadata --> UIDisplay
    
    style Tokenizer fill:#fff9c4
    style TikToken fill:#fff9c4
    style MetricsDB fill:#f3e5f5
    style UIDisplay fill:#e1f5ff





