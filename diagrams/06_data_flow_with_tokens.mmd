flowchart TB
    subgraph Input["Input"]
        Files["PDF/DOCX Files"]
        Questions["User Questions"]
        TokenInput["Token Counter Input"]
    end
    
    subgraph Processing["Processing Pipeline"]
        Parse["1. Parse Documents"]
        Chunk["2. Token-aware Chunking<br/>384 tokens/chunk"]
        CountTokens1["Count Tokens<br/>per Chunk"]
        Embed["3. Create Embeddings"]
        Store["4. Store in FAISS"]
    end
    
    subgraph Query["Query Pipeline"]
        Retrieve["1. Retrieve Chunks"]
        BuildContext["2. Build Context"]
        CountTokens2["Count Context Tokens"]
        Generate["3. Generate Answer"]
        CountResponse["Count Response Tokens"]
    end
    
    subgraph TokenTracking["Token Tracking"]
        TokenStats["Token Statistics<br/>Total tokens<br/>Per chunk<br/>Distribution"]
        QueryTokens["Query Tokens<br/>Context<br/>Response<br/>Total"]
        TokenAnalysis["Token Analysis<br/>Charts<br/>Min/Max/Avg<br/>Histogram"]
    end
    
    subgraph Output["Output"]
        Results["Processing Results<br/>+ Token Counts"]
        Answers["Answers + Sources<br/>+ Token Info"]
        Dashboard["Metrics Dashboard<br/>+ Token Analysis"]
    end
    
    Files --> Parse
    Parse --> Chunk
    Chunk --> CountTokens1
    CountTokens1 --> Embed
    Embed --> Store
    Store --> TokenStats
    
    Questions --> Retrieve
    Store --> Retrieve
    Retrieve --> BuildContext
    BuildContext --> CountTokens2
    CountTokens2 --> Generate
    Generate --> CountResponse
    CountResponse --> QueryTokens
    
    TokenInput --> CountTokens1
    
    TokenStats --> TokenAnalysis
    QueryTokens --> TokenAnalysis
    TokenAnalysis --> Dashboard
    
    Store --> Results
    Generate --> Answers
    Dashboard --> Output
    
    style CountTokens1 fill:#fff9c4
    style CountTokens2 fill:#fff9c4
    style CountResponse fill:#fff9c4
    style TokenStats fill:#f3e5f5
    style QueryTokens fill:#f3e5f5
    style TokenAnalysis fill:#f3e5f5





