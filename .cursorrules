# Project Intelligence (.cursorrules)

## Patterns
- WebSocket at `/ws`; expects `Authorization` header (Bearer).
- Messages support `{ "message": string }` or `{ "action": "agent", "question": string }`.
- Guardrails toggled by `rag_params.guardrails` (bool). Default currently off.
- Model selection: `payload.model_id` or `rag_params.model_params.model_id` â†’ forwarded to agent runtime.
- On guardrail failure, default allow to avoid UX regressions.
- **Planning Phase**: Agent creates execution plans before tool execution, sends "tool" type messages with planned actions.
- **Chain-of-Thought**: Enhanced real-time progress with action-specific updates during execution.

## Developer workflow
- Local: use `docker/docker-compose.yml` with `config/.env`.
- Health check: `GET /health`.
- When editing agent code, prefer readable names and guard clauses; keep streaming behavior intact.

## Critical Docker Configuration
- **Network requirement**: ARIS containers MUST be on `intelycx_intelycx_default` network to communicate with Intelycx API.
- **Network fix**: `docker network connect intelycx_intelycx_default [container]` for immediate fix.
- **Permanent fix**: Update docker-compose.yml `intelycx_net` to use `name: intelycx_intelycx_default`.

## FastMCP Integration Patterns
- **Server compliance**: Use Pydantic models for return types, avoid invalid `output_schema` parameter.
- **Client handling**: `result.data` contains Pydantic objects requiring conversion to JSON-serializable dicts.
- **Object conversion**: Comprehensive recursive conversion needed in `MCPServerManager.execute_tool()`.
- **Debugging**: Always log object types when troubleshooting serialization issues.

## Infra notes
- `infra` uses AWS CDK v2; default app context `env=dev`.
- `AgentStack` is a placeholder to be expanded with ECS/ALB and secrets.

## Documentation
- Memory Bank maintained in `memory-bank/` with brief, high-signal content.

## Commit Message Standards
- **MANDATORY**: Follow Conventional Commits specification for all commits.
- **Format**: `<type>[optional scope]: <description>`
- **Core types**: 
  - `feat:` - new features (MINOR version)
  - `fix:` - bug fixes (PATCH version)
  - `docs:` - documentation changes
  - `refactor:` - code refactoring without functional changes
  - `test:` - adding or updating tests
  - `chore:` - maintenance tasks, dependency updates
  - `ci:` - CI/CD pipeline changes
  - `perf:` - performance improvements
- **Breaking changes**: Use `!` after type (e.g., `feat!:`) or `BREAKING CHANGE:` footer (MAJOR version)
- **Scope examples**: `feat(agent):`, `fix(websocket):`, `docs(api):`, `chore(docker):`
- **Description**: Imperative mood, lowercase, no period, max 50 chars
- **Body/Footer**: Optional, separated by blank line, explain "what" and "why"
